#!/bin/sh

BASE=$(dirname $0)
DOTS="${BASE}/dots"

cd $BASE


case $1 in
install)
    SRC="./install"
    CMD=( ${@:2} )

    if [[ -d $SRC/$2 ]]; then
        CMD=( ${@:3} )
        SRC="$SRC/$2"
    fi

    if [[ $CMD = "all" ]]; then
        echo "Install all packages from $SRC"

        for item in $(ls $SRC); do
            [[ -d $SRC/$item ]] && continue
            [[ -x $SRC/$item ]] && \
                echo -e "  install: $SRC/$item (${CMD[@]:1})" && \
                ./$SRC/$item ${CMD[@]:1}
        done
    else
        [[ ! $CMD ]] && \
            echo -e "Usage: $(basename $0) install {package name|all|extra}" && \
            ls $SRC && exit 0

        [[ -x $SRC/$CMD ]] && \
            echo "Install $SRC/$CMD (${CMD[@]:1})" && \
            ./$SRC/$CMD ${CMD[@]:1}
    fi
    ;;

set)
    case $2 in
    ssh-agent)
        echo -e "\033[32m-- Activate SSH-Agent service --\033[0m"

        systemctl --user daemon-reload
        systemctl --user enable ssh-agent
        systemctl --user restart ssh-agent

        systemctl --user status ssh-agent
        ;;

    bg)
        feh --bg-fill $3
        ;;

    *)
        echo "..."
        ;;
    esac
    ;;

status)
    source ./CONFIGS

    for item in ${LIST[@]}; do
        ./utils/rcopy "$HOME/$item" "$DOTS/$item" simular
    done
    ;;

backup)
    source ./CONFIGS
    echo -e "-- Copy configs to $DOTS repository --"

    for item in ${LIST[@]}; do
        ./utils/rcopy "$HOME/$item" "$DOTS/$item"
    done
    ;;

restore)
    source ./CONFIGS
    echo -e "-- Copy configs from '$DOTS' repository --"

    for item in ${LIST[@]}; do
        ./utils/rcopy "$DOTS/$item" "$HOME/$item"
    done
    ;;

clean)
    echo -e "\033[31m-- Clean $DOTS directory --\033[0m"
    rm -rf $DOTS
    ;;

*)
    echo -e "Usage: $(basename $0) {install|set|status|backup|restore|clean}"
    echo -e "       $(basename $0) install {package name|all|extra} ..."
    ;;
esac
