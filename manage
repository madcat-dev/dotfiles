#!/bin/sh

BASE=$(dirname $0)
DOTS="${BASE}/dots"

cd $BASE

install() {
    LIST=${2}

    if [ ! "${LIST}" ]; then
        echo -e "Not packages in ${1} list"
        return 1
    fi

    echo -e "\033[32m-- Install ${1} packages --\033[0m"
    echo -e "Packages:\n\t${LIST}"

    pamac install ${LIST}
}


case $1 in
install)
    SRC="./install"
    CMD=( ${@:2} )

    if [[ -d $SRC/$2 ]]; then
        CMD=( ${@:3} )
        SRC="$SRC/$2"
    fi

    if [[ $CMD = "all" ]]; then
        echo "Install all packages from $SRC"

        for item in $(ls $SRC); do
            PKG="$SRC/$item"

            [[ -d $PKG ]] && continue
            [[ -x $PKG ]] && echo -e "  install: $PKG (${CMD[@]:1})"
        done
    else
        [[ ! $CMD ]] && \
            echo -e "Usage: manage install {package name|all|extra}" && \
            ls $SRC && exit 0

        [[ -x $SRC/$CMD ]] && \
            echo "Install $SRC/$CMD (${CMD[@]:1})"
    fi
    ;;

_install)
    source inc/PACKAGES

    case $2 in
    dev)
        echo -e "\033[32m-- Install Base-devel packages --\033[0m"
        sudo pacman -S base-devel
        install "Devel" "${DEVEL[*]}"
        ;;

    base)
        LIST="${DEPS[*]} ${FONTS[*]} ${THEMES[*]} ${UTILS[*]} ${MEDIA[*]} ${WM[*]}"
        install "Base" "${LIST}"
        ;;

    extra)
        install "Extra" "${EXTRA[*]}"
        ;;

    swap)
        echo -e "\033[32m-- Install Systemd SWAP packages --\033[0m"
        ./installers/swap.sh
        ;;

    freetype)
        echo -e "\033[32m-- Copy freetype config --\033[0m"
        sudo cp ./etc/profile.d/freetype2.sh /etc/profile.d
        ;;

    vim)
        echo -e "\033[32m-- Install vim environment --\033[0m"
        ./installers/vim.sh
        ;;

    *)
        echo -e "Usage: manage install {dev|base|swap|freetype|vim}"
        ;;

    esac
    ;;

remove)
    source inc/PACKAGES
    echo -e "\033[33m-- Remove packages from list --\033[0m"

    if [ ! ${REMOVE_PKGS[*]} ]; then
        echo -e "Not packages in remove list"
        exit 0
    fi

    echo -e "To remove:\n    ${REMOVE_PKGS[*]}"
    pamac remove ${REMOVE_PKGS[*]}
    ;;

status)
    source ./CONFIGS

    for item in ${LIST[@]}; do
        #./utils/rcopy "${HOME}/${item}" "${DOTS}/${item}" simular
        ./utils/rcopy "$HOME/$item" "$DOTS/$item" simular
    done
    ;;

backup)
    source ./CONFIGS
    echo -e "-- Copy configs to $DOTS repository --"

    for item in ${LIST[@]}; do
        ./utils/rcopy "$HOME/$item" "$DOTS/$item"
    done
    ;;

restore)
    source ./CONFIGS
    echo -e "-- Copy configs from '$DOTS' repository --"

    for item in ${LIST[@]}; do
        ./utils/rcopy "$DOTS/$item" "$HOME/$item"
    done
    ;;

clean)
    echo -e "\033[31m-- Clean $DOTS directory --\033[0m"
    rm -rf $DOTS
    ;;

*)
    echo -e "Usage: manage {install|remove|status|backup|restore|clean}"
    echo -e "       manage install {dev|base|swap|freetype|vim}"
    echo -e "       manage {backup|restore} [all]"
    ;;
esac


exit 0
