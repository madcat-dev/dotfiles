#!/bin/sh

BASE=$(dirname $0)
DOTS="${BASE}/dots"

cd $BASE


case $1 in
install)
    SRC="./install"
    CMD=( ${@:2} )

    if [[ -d $SRC/$2 ]]; then
        CMD=( ${@:3} )
        SRC="$SRC/$2"
    fi

    if [[ $CMD = "all" ]]; then
        echo "Install all packages from $SRC"

        for item in $(ls $SRC); do
            PKG="$SRC/$item"

            [[ -d $PKG ]] && continue
            [[ -x $PKG ]] && echo -e "  install: $PKG (${CMD[@]:1})"
        done
    else
        [[ ! $CMD ]] && \
            echo -e "Usage: manage install {package name|all|extra}" && \
            ls $SRC && exit 0

        [[ -x $SRC/$CMD ]] && \
            echo "Install $SRC/$CMD (${CMD[@]:1})"
    fi
    ;;

status)
    source ./CONFIGS

    for item in ${LIST[@]}; do
        #./utils/rcopy "${HOME}/${item}" "${DOTS}/${item}" simular
        ./utils/rcopy "$HOME/$item" "$DOTS/$item" simular
    done
    ;;

backup)
    source ./CONFIGS
    echo -e "-- Copy configs to $DOTS repository --"

    for item in ${LIST[@]}; do
        ./utils/rcopy "$HOME/$item" "$DOTS/$item"
    done
    ;;

restore)
    source ./CONFIGS
    echo -e "-- Copy configs from '$DOTS' repository --"

    for item in ${LIST[@]}; do
        ./utils/rcopy "$DOTS/$item" "$HOME/$item"
    done
    ;;

clean)
    echo -e "\033[31m-- Clean $DOTS directory --\033[0m"
    rm -rf $DOTS
    ;;

*)
    echo -e "Usage: manage {install|remove|status|backup|restore|clean}"
    echo -e "       manage install {dev|base|swap|freetype|vim}"
    echo -e "       manage {backup|restore}"
    ;;
esac


exit 0
