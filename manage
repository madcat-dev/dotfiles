#!/bin/sh

export BASE=$(realpath `dirname $0`)
cd $BASE

case $1 in
install)
    CMD=( ${@:2} )
    $BASE/lib/pack-util install ${CMD[@]}
    ;;

info)
    CMD=( ${@:2} )
    $BASE/lib/pack-util info ${CMD[@]}
    ;;

status)
    while IFS=\# read -r item _; do
        item=$(echo $item | sed 's/ *$//g') && [[ ${item} ]] && \
            ./lib/syncopy "$HOME/$item" "$BASE/backup/$item" simular
    done < ./CONFIGS
    ;;

backup)
    echo -e "-- Copy configs to $BASE/backup repository --"

    while IFS=\# read -r item _; do
        item=$(echo $item | sed 's/ *$//g') && [[ ${item} ]] && \
            ./lib/syncopy "$HOME/$item" "$BASE/backup/$item"
    done < ./CONFIGS
    ;;

restore)
    echo -e "-- Copy configs from $BASE/backup repository --"

    while IFS=\# read -r item _; do
        item=$(echo $item | sed 's/ *$//g') && [[ ${item} ]] && \
            ./lib/syncopy "$BASE/backup/$item" "$HOME/$item"
    done < ./CONFIGS
    ;;

clean)
    echo -e "\033[31m-- Clean $BASE/backup directory --\033[0m"
    rm -rf $BASE/backup
    ;;

*)
    echo -e "Usage: $(basename $0) {install|status|backup|restore|clean}"
    echo -e "       $(basename $0) install {package name|all|extra} ..."
    ;;

esac
