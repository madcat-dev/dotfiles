#!/bin/sh

STORAGE="./dots"

lscopy() {
    for item in ${1}
    do
        srce="${2}/${item}"
        dest="${3}/$(dirname $item)"

        if [ -e ${srce} ]; then
            echo -e " -  copy: ${srce} to ${dest}"

            mkdir -p "${dest}" > /dev/null 2>&1
            cp -rf "${srce}" "${dest}"
        else
            echo -e "\033[31m -  path '${srce}' not exists\033[0m"
        fi
    done
}


case $1 in
packages)
    case $2 in
    install)
        source inc/packages
        echo -e "\033[32m-- Install packages from list --\033[0m"

        echo -e "Fonts:\n    ${FONTS[*]}"
        echo -e "Themes:\n    ${THEMES[*]}"
        echo -e "Utils:\n    ${UTILS[*]}"
        echo -e "Media:\n    ${MEDIA[*]}"
        echo -e "WM:\n    ${WM[*]}"

        pamac install --as-deps ${FONTS[*]} ${THEMES[*]} ${UTILS[*]} ${MEDIA[*]} ${WM[*]}
        ;;

    remove)
        source inc/rmpackages
        echo -e "\033[33m-- Remove packages from list --\033[0m"

        if [ ! ${REMOVE[*]} ]; then
            echo -e "Not packages in remove list"
            exit 0
        fi

        echo -e "To remove:\n    ${REMOVE[*]}"
        pamac remove ${UNINSTALL[*]}
        ;;

    *)
        echo -e "Usage: manage packages {install|remove}"
        ;;

    esac
    ;;

backup)
    source inc/configs
    echo -e "\033[32m-- Copy configs to ${STORAGE} repository --\033[0m"

    mkdir -p "${STORAGE}" > /dev/null 2>&1
    lscopy "${LIST[*]}" "${HOME}" "${STORAGE}"
    ;;

restore)
    source inc/configs
    echo -e "\033[32m-- Copy configs from '${STORAGE}' repository --\033[0m"

    lscopy "${LIST[*]}" "${STORAGE}" "${HOME}"
    ;;

purge)
    echo -e "\033[31m-- Purge ${STORAGE} directory --\033[0m"
    rm -rf ${STORAGE}
    ;;

*)
    echo -e "Usage: manage {packages|backup|restore|purge} [{install|remove}]"
    echo -e "\tpackages - install and remove all packages from list"
    echo -e "\tbackup   - backup user configs to '${STORAGE}' repository"
    echo -e "\trestore  - restore user configs from '${STORAGE}' repository"
    echo -e "\tpurge    - clear repository configs"
    ;;
esac


exit 0
